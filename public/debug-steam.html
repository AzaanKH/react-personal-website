<!DOCTYPE html>
<html>
<head>
    <title>Steam API Debug</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .result { margin: 10px 0; padding: 10px; border: 1px solid #ccc; }
        .error { background: #ffe6e6; }
        .success { background: #e6ffe6; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <h1>Steam API Debug Test</h1>
    <button onclick="testConnection()">Test Basic Connection</button>
    <button onclick="testProfile()">Test Profile Endpoint</button>
    <div id="results"></div>

    <script>
        function log(message, isError = false) {
            const div = document.createElement('div');
            div.className = `result ${isError ? 'error' : 'success'}`;
            div.innerHTML = `<pre>${message}</pre>`;
            document.getElementById('results').appendChild(div);
        }

        async function testConnection() {
            try {
                log('Testing basic function accessibility...');
                
                // Test if the function exists at all
                const response = await fetch('/.netlify/functions/steam-proxy.cjs');
                const text = await response.text();
                
                log(`Response Status: ${response.status}`);
                log(`Response Headers: ${JSON.stringify(Object.fromEntries(response.headers.entries()), null, 2)}`);
                log(`Response Body: ${text}`);
                
                if (response.status === 400) {
                    log('✅ Function is accessible (expected 400 for missing endpoint parameter)');
                } else {
                    log(`⚠️ Unexpected status: ${response.status}`);
                }
            } catch (error) {
                log(`❌ Connection Error: ${error.message}`, true);
            }
        }

        async function testProfile() {
            try {
                log('Testing profile endpoint...');
                
                const url = '/.netlify/functions/steam-proxy.cjs?endpoint=profile';
                log(`Requesting: ${url}`);
                
                const response = await fetch(url);
                const text = await response.text();
                
                log(`Response Status: ${response.status}`);
                log(`Response Headers: ${JSON.stringify(Object.fromEntries(response.headers.entries()), null, 2)}`);
                
                if (response.ok) {
                    try {
                        const data = JSON.parse(text);
                        log(`✅ Success! Data: ${JSON.stringify(data, null, 2)}`);
                    } catch (parseError) {
                        log(`❌ JSON Parse Error: ${parseError.message}`, true);
                        log(`Raw Response: ${text}`);
                    }
                } else {
                    log(`❌ HTTP Error ${response.status}: ${text}`, true);
                }
            } catch (error) {
                log(`❌ Request Error: ${error.message}`, true);
            }
        }

        // Auto-test on load
        window.onload = () => {
            testConnection();
        };
    </script>
</body>
</html>